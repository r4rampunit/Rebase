from django.http import JsonResponse
from django.shortcuts import render

def mi_chart(request):
    folders = get_folders()
    selected_folder = request.GET.get("folder", None)
    selected_subfolder = request.GET.get("subfolder", None)
    subfolders = get_subfolders(selected_folder) if selected_folder else []

    if request.is_ajax():
        selected_items = request.GET.get('selectedItems', {})
        # Print the selected items for testing purposes
        print(selected_items)
        return JsonResponse({'status': 'success', 'selectedItems': selected_items})

    if selected_folder and selected_subfolder:
        dataframes = read_excel_files(selected_folder, selected_subfolder)
    else:
        dataframes = []

    context = {
        'folders': folders,
        'subfolders': subfolders,
        'dataframes': dataframes,
    }

    return render(request, 'mi_templates/mi_chart.html', context)





<!DOCTYPE html>
<html>
<head>
    <title>MI Chart</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            $(".multiselect").select2({
                placeholder: 'Select one or more than one options',
                closeOnSelect: false,
                allowClear: true,
                tags: true
            });

            function updateSelectedItems() {
                var allSelected = true;
                var selectedItems = {};
                $('.multiselect').each(function() {
                    var dropdownName = $(this).attr('name');
                    var selected = $(this).select2('data');
                    if (selected.length == 0) {
                        allSelected = false;
                    }
                    selectedItems[dropdownName] = selected.map(item => item.text);
                });
                if (allSelected) {
                    var html = '<h3>Selected Items:</h3>';
                    for (var dropdown in selectedItems) {
                        html += '<p><strong>' + dropdown + ':</strong> ' + selectedItems[dropdown].join(', ') + '</p>';
                    }
                    $('#selectedItems').html(html).show();

                    // Send selected items to the server via AJAX
                    $.ajax({
                        url: window.location.href,
                        method: 'GET',
                        data: { selectedItems: JSON.stringify(selectedItems) },
                        success: function(response) {
                            console.log('Selected items sent to server successfully.');
                        },
                        error: function(xhr, status, error) {
                            console.error('Error sending selected items to server:', error);
                        }
                    });
                } else {
                    $('#selectedItems').hide();
                }
            }

            $('.multiselect').on('change', updateSelectedItems);
        });
    </script>
</head>
<body>
    <img src="/static/img/HSBC_hex.png" alt="Logo" class="logo">
    <center>
        <h1>Multiple Multi Multiselect Dropdowns</h1>
        <hr/>
        <div class="dropdowns-container">
            <div class="dropdowns-wrapper">
                <div class="dropdown-wrapper">
                    <select class="multiselect" name="Dropdown1" multiple>
                        <option>Option 1</option>
                        <option>Option 2</option>
                        <option>Option 3</option>
                        <option>Option 4</option>
                        <option>Option 5</option>
                    </select>
                </div>
                <div class="dropdown-wrapper">
                    <select class="multiselect" name="Dropdown2" multiple>
                        <option>Option 1</option>
                        <option>Option 2</option>
                        <option>Option 3</option>
                        <option>Option 4</option>
                        <option>Option 5</option>
                    </select>
                </div>
                <div class="dropdown-wrapper">
                    <select class="multiselect" name="Dropdown3" multiple>
                        <option>Option 1</option>
                        <option>Option 2</option>
                        <option>Option 3</option>
                        <option>Option 4</option>
                        <option>Option 5</option>
                    </select>
                </div>
                <div class="dropdown-wrapper">
                    <select class="multiselect" name="Dropdown4" multiple>
                        <option>Option 1</option>
                        <option>Option 2</option>
                        <option>Option 3</option>
                        <option>Option 4</option>
                        <option>Option 5</option>
                    </select>
                </div>
            </div>
        </div>
        <div id="selectedItems" style="display: none;"></div>
    </center>
</body>
</html>
