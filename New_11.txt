import sqlite3

try:
    # Connect to the SQLite database
    conn = sqlite3.connect(self_path)
    cursor = conn.cursor()

    # Step 1: Get all columns except 2015_flag
    cursor.execute('PRAGMA table_info(Monthly_table);')
    columns = cursor.fetchall()
    column_names = [col[1] for col in columns if col[1] != '2015_flag']
    columns_string = ', '.join(column_names)

    # Step 2: Create new table with desired columns
    cursor.execute(f'''
        CREATE TABLE Monthly_table_new AS 
        SELECT {columns_string}
        FROM Monthly_table;
    ''')

    # Step 3: Drop the old table
    cursor.execute('DROP TABLE Monthly_table;')

    # Step 4: Rename the new table to the original name
    cursor.execute('ALTER TABLE Monthly_table_new RENAME TO Monthly_table;')

    # Commit the changes
    conn.commit()
    print("Column '2015_flag' successfully deleted")

except sqlite3.Error as e:
    print(f"An error occurred: {e}")
    conn.rollback()

finally:
    # Close the connection
    conn.close()