<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        #chart {
            width: 100%;
            height: 500px;
        }
    </style>
</head>
<body>
    <h1>Interactive Dashboard</h1>

    <div>
        <label for="variable_select">Variable:</label>
        <select id="variable_select">
            {% for variable in variable_options %}
            <option value="{{ variable }}">{{ variable }}</option>
            {% endfor %}
        </select>

        <label for="country_select">Country:</label>
        <select id="country_select">
            {% for country in country_options %}
            <option value="{{ country }}">{{ country }}</option>
            {% endfor %}
        </select>

        <label for="model_select">Model:</label>
        <select id="model_select">
            {% for model in model_options %}
            <option value="{{ model }}">{{ model }}</option>
            {% endfor %}
        </select>

        <label for="chart_type_select">Chart Type:</label>
        <select id="chart_type_select">
            <option value="line">Line Chart</option>
            <option value="bar">Bar Chart</option>
        </select>
    </div>

    <div id="chart"></div>

    <script>
        var data = JSON.parse('{{ data|safe }}');

        var variable_select = document.getElementById('variable_select');
        var country_select = document.getElementById('country_select');
        var model_select = document.getElementById('model_select');
        var chart_type_select = document.getElementById('chart_type_select');

        function filterData() {
            var selectedVariable = variable_select.value;
            var selectedCountry = country_select.value;
            var selectedModel = model_select.value;
            var selectedChartType = chart_type_select.value;

            var filteredData = data.filter(function(row) {
                return row['Variable'] === selectedVariable && row['Region'] === selectedCountry && row['Model'] === selectedModel;
            });

            console.log('Filtered Data:', filteredData);

            if (filteredData.length === 0) {
                console.log('No data found for the selected combination.');
                return;
            }

            var years = Object.keys(filteredData[0]).filter(function(key) {
                return !isNaN(parseInt(key));
            });

            console.log('Years:', years);

            var trace = {
                x: years,
                y: years.map(function(year) {
                    return filteredData[0][year];
                }),
                type: selectedChartType,
                mode: 'lines+markers'
            };

            var layout = {
                title: `${selectedVariable} for ${selectedCountry} (${selectedModel})`,
                xaxis: {
                    title: 'Year'
                },
                yaxis: {
                    title: selectedVariable
                }
            };

            Plotly.newPlot('chart', [trace], layout);
        }

        variable_select.addEventListener('change', filterData);
        country_select.addEventListener('change', filterData);
        model_select.addEventListener('change', filterData);
        chart_type_select.addEventListener('change', filterData);

        filterData();
    </script>
</body>
</html>